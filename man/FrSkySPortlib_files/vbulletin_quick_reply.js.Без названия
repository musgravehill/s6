/*!======================================================================*\
|| #################################################################### ||
|| # ---------------------------------------------------------------- # ||
|| # This file may not be redistributed in whole or significant part. # ||
|| # ---------------- VBULLETIN IS NOT FREE SOFTWARE ---------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html # ||
|| #################################################################### ||
\*======================================================================*/
;var qr_repost=false;var qr_errors_shown=false;var qr_active=false;var qr_ajax=null;var clickedelm=false;function qr_init(){qr_disable_controls();qr_init_buttons(fetch_object("posts"))}function qr_init_buttons(c){var b=fetch_tags(c,"a");for(var a=0;a<b.length;a++){if(b[a].id&&b[a].id.substr(0,3)=="qr_"){b[a].onclick=function(d){return qr_activate(this.id.substr(3))}}}}function qr_disable_controls(){if(require_click){fetch_object("qr_postid").value=0;vB_Editor[QR_EditorID].disable_editor(vbphrase.click_quick_reply_icon);var a=fetch_object("cb_signature");if(a!=null){a.disabled=true}active=false;qr_active=false}else{vB_Editor[QR_EditorID].write_editor_contents("");qr_active=true}if(threaded_mode!=1){fetch_object("qr_quickreply").disabled=true}}function qr_activate(c){var b=fetch_object("collapseobj_quickreply");if(b&&b.style.display=="none"){toggle_collapse("quickreply")}fetch_object("qr_postid").value=c;if(fetch_object("qr_specifiedpost")){fetch_object("qr_specifiedpost").value=1}fetch_object("qr_quickreply").disabled=false;var a=fetch_object("cb_signature");if(a){a.disabled=false;a.checked=true}if(qr_active==false){vB_Editor[QR_EditorID].enable_editor("")}if(!is_ie&&vB_Editor[QR_EditorID].wysiwyg_mode){fetch_object("qr_scroll").scrollIntoView(false)}vB_Editor[QR_EditorID].check_focus();qr_active=true;return false}function qr_prepare_submit(d,a){if(qr_repost==true){return true}if(!allow_ajax_qr||!AJAX_Compatible){return qr_check_data(d,a)}else{if(qr_check_data(d,a)){if(typeof vb_disable_ajax!="undefined"&&vb_disable_ajax>0){return true}if(is_ie&&userAgent.indexOf("msie 5.")!=-1){if(PHP.urlencode(d.message.value).indexOf("%u")!=-1){return true}}if(YAHOO.util.Connect.isCallInProgress(qr_ajax)){return false}if(clickedelm==d.preview.value){return true}else{var e="ajax=1";if(typeof ajax_last_post!="undefined"){e+="&ajax_lastpost="+PHP.urlencode(ajax_last_post)}for(var c=0;c<d.elements.length;c++){var f=d.elements[c];if(f.name&&!f.disabled){switch(f.type){case"text":case"textarea":case"hidden":e+="&"+f.name+"="+PHP.urlencode(f.value);break;case"checkbox":case"radio":e+=f.checked?"&"+f.name+"="+PHP.urlencode(f.value):"";break;case"select-one":e+="&"+f.name+"="+PHP.urlencode(f.options[f.selectedIndex].value);break;case"select-multiple":for(var b=0;b<f.options.length;b++){e+=(f.options[b].selected?"&"+f.name+"="+PHP.urlencode(f.options[b].value):"")}break}}}fetch_object("qr_posting_msg").style.display="";document.body.style.cursor="wait";qr_ajax_post(d.action,e);return false}}else{return false}}}function qr_resubmit(){qr_repost=true;var a=document.createElement("input");a.type="hidden";a.name="ajaxqrfailed";a.value="1";fetch_object("qrform").appendChild(a);fetch_object("qrform").submit()}function qr_check_data(b,a){switch(fetch_object("qr_postid").value){case"0":alert(vbphrase.click_quick_reply_icon);return false;case"who cares":if(typeof b.quickreply!="undefined"){b.quickreply.checked=false}break}if(clickedelm==b.preview.value){a=0}return vB_Editor[QR_EditorID].prepare_submit(0,a)}function qr_ajax_post(b,a){if(YAHOO.util.Connect.isCallInProgress(qr_ajax)){YAHOO.util.Connect.abort(qr_ajax)}qr_repost=false;qr_ajax=YAHOO.util.Connect.asyncRequest("POST",b,{success:qr_do_ajax_post,failure:qr_handle_error,timeout:vB_Default_Timeout},SESSIONURL+"securitytoken="+SECURITYTOKEN+"&"+a)}function qr_handle_error(a){vBulletin_AJAX_Error_Handler(a);fetch_object("qr_posting_msg").style.display="none";document.body.style.cursor="default";qr_resubmit()}function qr_do_ajax_post(g){if(g.responseXML){document.body.style.cursor="auto";fetch_object("qr_posting_msg").style.display="none";var d;if(fetch_tag_count(g.responseXML,"postbit")){ajax_last_post=g.responseXML.getElementsByTagName("time")[0].firstChild.nodeValue;qr_disable_controls();qr_hide_errors();var c=g.responseXML.getElementsByTagName("postbit");for(d=0;d<c.length;d++){var j=document.createElement("div");j.innerHTML=c[d].firstChild.nodeValue;var e=fetch_object("lastpost");var b=e.parentNode;var a=b.insertBefore(j,e);PostBit_Init(a,c[d].getAttribute("postid"))}if(fetch_object("qr_submit")){fetch_object("qr_submit").blur()}}else{if(!is_saf){var h=g.responseXML.getElementsByTagName("error");if(h.length){var f="<ol>";for(d=0;d<h.length;d++){f+="<li>"+h[d].firstChild.nodeValue+"</li>"}f+="</ol>";qr_show_errors("<ol>"+f+"</ol>");return false}}qr_resubmit()}}else{qr_resubmit()}}function qr_show_errors(a){qr_errors_shown=true;fetch_object("qr_error_td").innerHTML=a;fetch_object("qr_error_tbody").style.display="";vB_Editor[QR_EditorID].check_focus();return false}function qr_hide_errors(){if(qr_errors_shown){qr_errors_shown=true;fetch_object("qr_error_tbody").style.display="none";return false}}var vB_QuickReply=true;